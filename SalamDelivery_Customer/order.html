<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Salam Delivery | Place Order</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:"Poppins",sans-serif;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      background:linear-gradient(135deg,#000 40%,#FFD600 100%);
      color:#fff;
      padding:20px;
    }
    .card{
      background:rgba(0,0,0,0.75);
      border-radius:18px;
      padding:24px 20px;
      width:100%;
      max-width:420px;
      box-shadow:0 0 25px rgba(0,0,0,0.8);
      border:1px solid #FFD600;
    }
    h1{
      font-size:22px;
      margin-bottom:6px;
      color:#FFD600;
      text-align:center;
    }
    p.sub{
      font-size:12px;
      text-align:center;
      margin-bottom:18px;
      color:#ddd;
    }
    label{
      display:block;
      font-size:13px;
      margin:8px 0 4px;
    }
    input,textarea{
      width:100%;
      padding:9px 10px;
      border-radius:8px;
      border:none;
      font-size:14px;
      margin-bottom:4px;
    }
    textarea{min-height:60px;resize:vertical;}
    .row{
      display:flex;
      gap:10px;
    }
    .row > div{flex:1;}
    button{
      margin-top:12px;
      width:100%;
      padding:11px;
      border-radius:10px;
      border:none;
      background:#FFD600;
      color:#000;
      font-weight:600;
      font-size:15px;
      cursor:pointer;
      transition:0.25s;
    }
    button:hover{
      background:#000;
      color:#FFD600;
    }
    .msg{
      margin-top:10px;
      font-size:13px;
      text-align:center;
    }
    .msg.ok{color:#b2ff59;}
    .msg.err{color:#ff8a80;}
  </style>
</head>
<body>
  <div class="card">
    <h1>Salam Delivery</h1>
    <p class="sub">Place your delivery order. Our drivers will take care of the rest ðŸšš</p>

    <label>Restaurant / Shop name</label>
    <input id="vendor_name" placeholder="e.g. Burger House" />

    <label>Your name</label>
    <input id="customer_name" placeholder="Your name" />

    <label>Phone (WhatsApp)</label>
    <input id="customer_phone" placeholder="+971..." />

    <label>Pickup address</label>
    <input id="pickup_address" placeholder="From where to collect?" />

    <label>Dropoff address</label>
    <input id="dropoff_address" placeholder="Where to deliver?" />

    <div class="row">
      <div>
        <label>Order amount (AED)</label>
        <input id="total_price" type="number" step="0.01" placeholder="Example: 45" />
      </div>
    </div>

    <label>Order details / notes</label>
    <textarea id="notes" placeholder="Food items, building, apartment number, etc."></textarea>

    <button onclick="submitOrder()">Confirm Order</button>
    <div id="message" class="msg"></div>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabaseUrl = "https://nfmaqndlsbizkafzhigd.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5mbWFxbmRsc2JpemthZnpoaWdkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIzMzU5NjUsImV4cCI6MjA3NzkxMTk2NX0.ILsyiRbVNlOjwFV3f4Yt5-RROBA2gwQ0J-oMPFlRRDc";
    const supabase = createClient(supabaseUrl, supabaseKey);

    const msgEl = document.getElementById("message");

    window.submitOrder = async function(){
      msgEl.textContent = "";
      msgEl.className = "msg";

      const vendor_name    = document.getElementById("vendor_name").value.trim();
      const customer_name  = document.getElementById("customer_name").value.trim();
      const customer_phone = document.getElementById("customer_phone").value.trim();
      const pickup_address = document.getElementById("pickup_address").value.trim();
      const dropoff_address= document.getElementById("dropoff_address").value.trim();
      const total_price    = parseFloat(document.getElementById("total_price").value || "0");
      const notes          = document.getElementById("notes").value.trim();

      if(!customer_name || !customer_phone || !pickup_address || !dropoff_address){
        msgEl.textContent = "Please fill in name, phone, pickup and dropoff.";
        msgEl.classList.add("err");
        return;
      }

      const { error } = await supabase
        .from("orders")
        .insert([
          {
            vendor_name,
            customer_name,
            customer_phone,
            pickup_address,
            dropoff_address,
            total_price: isNaN(total_price)?0:total_price,
            notes,
            status: "Pending",
            driver_id: null
          }
        ]);

      if(error){
        console.error(error);
        msgEl.textContent = "Error sending order: " + error.message;
        msgEl.classList.add("err");
      }else{
        msgEl.textContent = "Your order has been sent âœ…. We will contact you shortly.";
        msgEl.classList.add("ok");
        // ØªÙØ±ÙŠØº Ø§Ù„ÙÙˆØ±Ù…
        ["vendor_name","customer_name","customer_phone","pickup_address","dropoff_address","total_price","notes"]
          .forEach(id=>document.getElementById(id).value="");
      }
    };
  </script>
</body>
</html>
